"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.makeMiddleware=void 0;const onFinished=require("on-finished");const context_1=require("../../utils/context");const http_request_1=require("../../utils/http-request");function makeMiddleware(projectId,makeChildLogger,emitRequestLog){return(req,res,next)=>{const requestStartMs=Date.now();const traceContext=(0,context_1.getOrInjectContext)(req,projectId,true);req.log=makeChildLogger(traceContext.trace,traceContext.spanId,traceContext.traceSampled);if(emitRequestLog){onFinished(res,()=>{const latencyMs=Date.now()-requestStartMs;const httpRequest=(0,http_request_1.makeHttpRequestData)(req,res,latencyMs);emitRequestLog(httpRequest,traceContext.trace,traceContext.spanId,traceContext.traceSampled)})}next()}}exports.makeMiddleware=makeMiddleware;
//# sourceMappingURL=make-middleware.js.map